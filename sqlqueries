select * from df_orders

--ques1-find top10 highest revenue generating products
select product_id, round(cast(sum(sale_price) as numeric),2) as sales
from df_orders
group by product_id
order by sales desc
limit 10

--ques2- find top 5 highest selling products in each region
with cte as (
select region,product_id, round(cast(sum(sale_price) as numeric),3) as sales
from df_orders
group by region,product_id
order by region, sales desc
),
cte1 as(
select *, rank()over(partition by region order by sales desc ) as rn
from cte 
)

select * 
from cte1
where rn <= 5


--ques 3-find month over month growth comparison for 2022 & 2023 sales eg jan 2022 vs jan 2023

with cte as (
select extract(year from order_date) as order_year, extract(month from order_date) as order_month, 
sum(sale_price) as sales
from df_orders
group by order_year, order_month
--order by order_year, order_month
) 
select order_month,
sum(case when order_year = 2022 then sales else 0 end) as sales_2022,
sum(case when order_year = 2023 then sales else 0 end) as sales_2023
from cte 
group by order_month
order by order_month

--ques4 --for which category which month has highest sales
select * from df_orders

with cte as (
select category,extract(year from order_date) as y, extract(month from order_date) as m,
sum(sale_price) as sales
from df_orders 
group by category,y, m
), cte1 as (
select *, 
row_number()over(partition by category order by sales desc ) as rn 
from cte
)
select category, round(cast(sales as numeric), 2) as sales
from cte1 
where rn =1


--ques3- which category has highest growth by profit in 2023 compare 2022

with cte as (
select sub_category,extract(year from order_date) as order_year, 
sum(sale_price) as sales
from df_orders
group by order_year,sub_category
--order by order_year, order_month
), cte1 as (
select sub_category,
sum(case when order_year = 2022 then sales else 0 end) as sales_2022,
sum(case when order_year = 2023 then sales else 0 end) as sales_2023
from cte 
group by sub_category
)

select *,
(sales_2023- sales_2022)*100.0/sales_2022  as sales_growth
from cte1
order by sales_growth desc
limit 1





